{% load static %}
{% load i18n %}
<div x-data="{ desktopMenuOpen: false, mobileMenuOpen: false }">
  <!-- Header -->
  <header class="mx-auto flex w-full h-16 max-w-[1200px] items-center justify-between px-5">
    <a href="{% url 'homepage' %}">
      <img
        class="h-10 w-auto object-contain cursor-pointer"
        src="{% static 'images/metatakaslogo.png' %}"
        alt="company logo"
      />
    </a>

    <div class="md:hidden">
      <button @click="mobileMenuOpen = !mobileMenuOpen" class="relative w-10 h-10 focus:outline-none">
        <div class="absolute w-6 transform -translate-x-1/2 -translate-y-1/2 left-1/2 top-1/2">
          <span 
            class="absolute h-0.5 w-6 bg-black transform transition duration-300 ease-in-out"
            :class="{'rotate-45': mobileMenuOpen, '-translate-y-1.5': !mobileMenuOpen}">
          </span>
          <span 
            class="absolute h-0.5 w-6 bg-black transform transition-all duration-200"
            :class="{'opacity-0': mobileMenuOpen}">
          </span>
          <span 
            class="absolute h-0.5 w-6 bg-black transform transition duration-300 ease-in-out"
            :class="{'-rotate-45': mobileMenuOpen, 'translate-y-1.5': !mobileMenuOpen}">
          </span>
        </div>
      </button>
    </div>

    <!-- Centered Search Bar -->
    <form method="get" action="{% url 'product_list' %}" class="hidden h-9 w-2/5 items-center border md:flex">   
      <label for="default-search" class="text-sm font-medium text-gray-900 sr-only dark:text-white">Search</label>
      <div class="relative lex w-full max-w-xl">
        <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
          <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
          </svg>
        </div>
        <input
          type="search"
          id="default-search"
          name="q"
          value="{{ request.GET.q }}"
          class="block w-full p-4 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-white-700 dark:border-gray-600 dark:focus:ring-blue-500 dark:focus:border-blue-500"
          placeholder="{% trans 'Search listings...' %}"
        />
        <button type="submit" class="text-white absolute end-2.5 bottom-2.5 bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-6 py-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
          {% trans 'Search' %}
        </button>
        {% if current_listing_type %}
          <input type="search" value="{{ current_listing_type }}">
        {% endif %}      
      </div>
    </form>

    <!-- Right Side - Language Switcher and User Info -->
    <div class="hidden gap-3 md:!flex">
      <!-- Language Switcher -->
      <form action="{% url 'set_language' %}" method="post" class="relative">
        {% csrf_token %}
        <input type="hidden" name="next" value="/{{ LANGUAGE_CODE }}/">
        <div class="relative">
          <select name="language" onchange="updateLanguageAndSubmit(this.form)"
            class="appearance-none w-36 text-sm border border-gray-300 rounded-md py-2 pr-10 bg-white shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-medium">
            {% get_current_language as LANGUAGE_CODE %}
            {% get_available_languages as LANGUAGES %}
            {% for lang in LANGUAGES %}
              {% if lang.0 == "en" %}
                <option value="en" {% if lang.0 == LANGUAGE_CODE %} selected{% endif %}>ğŸ‡¬ğŸ‡§ English</option>
              {% elif lang.0 == "tr" %}
                <option value="tr" {% if lang.0 == LANGUAGE_CODE %} selected{% endif %}>ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
              {% elif lang.0 == "de" %}
                <option value="de" {% if lang.0 == LANGUAGE_CODE %} selected{% endif %}>ğŸ‡©ğŸ‡ª Deutsch</option>
              {% else %}
                <option value="{{ lang.0 }}" {% if lang.0 == LANGUAGE_CODE %} selected{% endif %}>ğŸŒ {{ lang.1 }}</option>
              {% endif %}
            {% endfor %}
          </select>
        </div>
      </form>
    </div>

  </header>

  <!-- Mobile Menu -->
  <section
    x-show="mobileMenuOpen"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="translate-x-full"
    x-transition:enter-end="translate-x-0"
    x-transition:leave="transition ease-in duration-300"
    x-transition:leave-start="translate-x-0"
    x-transition:leave-end="translate-x-full"
    @click.outside="mobileMenuOpen = false"
    class="absolute left-0 right-0 z-50 h-screen w-full bg-white transform"
    style="display: none"
  >
    <div class="p-4">
      <!-- Mobile Search -->
      <form method="get" action="{% url 'product_list' %}" class="w-full max-w-[600px] mx-auto mb-4">
        <div class="flex items-center border border-gray-300 rounded-lg bg-gray-50 px-3 py-2">
          <svg class="w-5 h-5 text-gray-500 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
          </svg>
          <input
            type="search"
            name="q"
            value="{{ request.GET.q }}"
            placeholder="{% trans 'Search listings...' %}"
            class="flex-grow text-sm text-gray-900 bg-transparent outline-none"
          />
          <button type="submit" class="ml-3 px-4 py-2 text-sm text-white bg-blue-700 hover:bg-blue-800 rounded-md">
            {% trans 'Search' %}
          </button>
        </div>
      </form>

      <!-- Mobile Language Switcher -->
      <!-- Mobile Language Switcher (with flags) -->
      <div class="w-full max-w-[600px] mx-auto mb-4">
        <form action="{% url 'set_language' %}" method="post" class="flex justify-center">
          {% csrf_token %}
          <input type="hidden" name="next" value="{{ request.get_full_path }}">
          <select name="language" onchange="this.form.submit()"
            class="w-40 text-sm border border-gray-300 rounded-lg px-3 py-2 focus:ring-blue-500 focus:border-blue-500 bg-white shadow-sm font-medium">
            {% get_current_language as LANGUAGE_CODE %}
            {% get_available_languages as LANGUAGES %}
            {% for lang in LANGUAGES %}
              {% if lang.0 == "en" %}
                <option value="en" {% if lang.0 == LANGUAGE_CODE %} selected{% endif %}>ğŸ‡¬ğŸ‡§ English</option>
              {% elif lang.0 == "tr" %}
                <option value="tr" {% if lang.0 == LANGUAGE_CODE %} selected{% endif %}>ğŸ‡¹ğŸ‡· TÃ¼rkÃ§e</option>
              {% elif lang.0 == "de" %}
                <option value="de" {% if lang.0 == LANGUAGE_CODE %} selected{% endif %}>ğŸ‡©ğŸ‡ª Deutsch</option>
              {% else %}
                <option value="{{ lang.0 }}" {% if lang.0 == LANGUAGE_CODE %} selected{% endif %}>ğŸŒ {{ lang.1 }}</option>
              {% endif %}
            {% endfor %}
          </select>
        </form>
      </div>


      <!-- Mobile Navigation -->
      <ul class="text-center font-medium">
        <li class="py-2"><a href="{% url 'homepage' %}">{% trans 'Home' %}</a></li>
        <li class="py-2"><a href="{% url 'product_list' %}">{% trans 'Listings' %}</a></li>
        <li class="py-2"><a href="{% url 'aboutus' %}">{% trans 'About Us' %}</a></li>
        <li class="py-2"><a href="{% url 'contact' %}">{% trans 'Contact' %}</a></li>
      </ul>
    </div>
  </section>

  <!-- Desktop Navigation Bar - Centered -->
  <nav class="relative bg-blue-800">
    <div class="mx-auto hidden h-12 w-full max-w-[1200px] items-center md:flex">
      <div class="absolute left-1/2 transform -translate-x-1/2 flex gap-12">
        <a class="font-light text-white duration-200 hover:text-blue-400 relative after:absolute after:bottom-0 after:left-0 after:h-0.5 after:w-0 after:bg-blue-400 after:transition-all after:duration-200 hover:after:w-full" href="{% url 'homepage' %}">
          {% trans 'Home' %}
        </a>
        <a class="font-light text-white duration-200 hover:text-blue-400 relative after:absolute after:bottom-0 after:left-0 after:h-0.5 after:w-0 after:bg-blue-400 after:transition-all after:duration-200 hover:after:w-full" href="{% url 'product_list' %}">
          {% trans 'Listings' %}
        </a>
        <a class="font-light text-white duration-200 hover:text-blue-400 relative after:absolute after:bottom-0 after:left-0 after:h-0.5 after:w-0 after:bg-blue-400 after:transition-all after:duration-200 hover:after:w-full" href="{% url 'aboutus' %}">
          {% trans 'About Us' %}
        </a>
        <a class="font-light text-white duration-200 hover:text-blue-400 relative after:absolute after:bottom-0 after:left-0 after:h-0.5 after:w-0 after:bg-blue-400 after:transition-all after:duration-200 hover:after:w-full" href="{% url 'contact' %}">
          {% trans 'Contact' %}
        </a>
      </div>

      <div class="ml-auto flex gap-4 px-5">
        {% if user.is_authenticated %}
          <span class="font-light text-white">{% trans 'Welcome' %}, {{ user.first_name }}</span>
        {% endif %}
      </div>
    </div>
  </nav>
</div>

<script>
function updateLanguageAndSubmit(form) {
  const lang = form.language.value;
  form.next.value = '/' + lang + '/';
  form.submit();
}
</script>
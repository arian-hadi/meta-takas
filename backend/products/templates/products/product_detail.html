{% extends 'base.html' %}
{% load static %}
{% block title %}Product Detail{% endblock %}

{% block content %}

<!-- Breadcrumb -->
<nav class="mx-auto w-full mt-4 max-w-[1200px] px-5">
    <ul class="flex items-center">
        <li class="cursor-pointer">
            <a href="{% url 'product_list' %}">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-5 w-5">
                    <path d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z" />
                    <path d="M12 5.432l8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 01-.75-.75v-4.5a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75V21a.75.75 0 01-.75.75H5.625a1.875 1.875 0 01-1.875-1.875v-6.198a2.29 2.29 0 00.091-.086L12 5.43z" />
                </svg>
            </a>
        </li>
        <li><span class="mx-2 text-gray-500">&gt;</span></li>
        <li class="text-gray-500">{{ product.name }}</li>
    </ul>
</nav>

<section class="container flex-grow mx-auto max-w-[1200px] border-b py-5 lg:grid lg:grid-cols-2 lg:py-10">

    <!-- Product Images Carousel -->
    <!-- Product Images Gallery -->
    <div class="container mx-auto px-4">
        <div class="flex flex-col items-center">
            <!-- Main Swiper (big image, swipeable) -->
            <div class="swiper main-swiper w-full max-h-96 rounded border mb-4">
            <div class="swiper-wrapper">
                {% if product.image %}
                <div class="swiper-slide">
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="object-contain w-full max-h-96"/>
                </div>
                {% endif %}
                {% for image in product.images.all %}
                {% if not product.image or image.image.url != product.image.url %}
                <div class="swiper-slide">
                    <img src="{{ image.image.url }}" alt="Product Image" class="object-contain w-full max-h-96"/>
                </div>
                {% endif %}
                {% endfor %}
            </div>
            <!-- Optional navigation buttons -->
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
            </div>
            <!-- Thumbnails (static row, always visible) -->
            <div class="flex gap-2 mt-4 flex-wrap justify-center">
            {% if product.image %}
            <img src="{{ product.image.url }}" alt="Thumbnail"
                class="thumbnail w-20 h-20 object-cover rounded border cursor-pointer"
                data-index="0"/>
            {% endif %}
            {% for image in product.images.all %}
                {% if not product.image or image.image.url != product.image.url %}
                <img src="{{ image.image.url }}" alt="Thumbnail"
                    class="thumbnail w-20 h-20 object-cover rounded border cursor-pointer"
                    data-index="{{ forloop.counter }}"/>
                {% endif %}
            {% endfor %}
            </div>
        </div>
    </div>

    <!-- Product Info -->
    <div class="mx-auto px-5 lg:px-5">
        <h1 class="pt-3 text-2xl font-bold lg:pt-0">{{product.name}}</h2>

        <p class="mt-5 font-bold">Category: <span class="font-normal">{{ product.category.name }}</span></p>
        <!-- <p class="font-bold">Price: <span class="text-violet-900 font-bold text-2xl">${{ product.price }}</span></p> -->
        <p class="mt-4 text-4xl font-bold text-violet-900">
           ${{ product.price }} 
        </p>

        <p class="pt-5 text-sm leading-5 text-gray-500">{{ product.description }}</p>

        <!-- Contact Info -->

        <div class="mt-7 flex flex-col gap-4 sm:flex-row sm:gap-6">
            <!-- Contact via Email -->
            <a
                href="mailto:{{ product.email }}"
                class="flex h-12 items-center justify-center rounded bg-violet-900 text-white transition 
                    hover:bg-violet-800 px-6 sm:px-8"
            >
                <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                class="mr-2 h-5 w-5 flex-shrink-0"
                >
                <path
                    fill="#FFFFFF"
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M3.75 5.25L3 6V18L3.75 18.75H20.25L21 18V6L20.25 5.25H3.75ZM4.5 7.6955V17.25H19.5V7.69525L11.9999 14.5136L4.5 7.6955ZM18.3099 6.75H5.68986L11.9999 12.4864L18.3099 6.75Z"
                />
                </svg>
                Contact via Email
            </a>

            <!-- Contact via WhatsApp -->
            <a
                href="https://wa.me/{{ product.whatsapp_number }}"
                target="_blank"
                class="flex h-12 items-center justify-center rounded bg-green-700 text-white transition 
                    hover:bg-green-500 px-6 sm:px-8"
            >
                <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 58 58"
                class="mr-2 h-5 w-5 flex-shrink-0"
                >
                <g>
                    <path
                    fill="#2CB742"
                    d="M0,58l4.988-14.963C2.457,38.78,1,33.812,1,28.5C1,12.76,13.76,0,29.5,0S58,12.76,58,28.5
                        S45.24,57,29.5,57c-4.789,0-9.299-1.187-13.26-3.273L0,58z"
                    />
                    <path
                    fill="#FFFFFF"
                    d="M47.683,37.985c-1.316-2.487-6.169-5.331-6.169-5.331c-1.098-0.626-2.423-0.696-3.049,0.42
                        c0,0-1.577,1.891-1.978,2.163c-1.832,1.241-3.529,1.193-5.242-0.52l-3.981-3.981l-3.981-3.981
                        c-1.713-1.713-1.761-3.41-0.52-5.242c0.272-0.401,2.163-1.978,2.163-1.978c1.116-0.627,1.046-1.951,0.42-3.049
                        c0,0-2.844-4.853-5.331-6.169c-1.058-0.56-2.357-0.364-3.203,0.482l-1.758,1.758c-5.577,5.577-2.831,11.873,2.746,17.45
                        l5.097,5.097l5.097,5.097c5.577,5.577,11.873,8.323,17.45,2.746l1.758-1.758C48.048,40.341,48.243,39.042,47.683,37.985z"
                    />
                </g>
                </svg>
                Contact via WhatsApp
            </a>
        </div>


    </div>
</section>

<!-- Product Details Section -->
<section class="container mx-auto max-w-[1200px] px-5 py-5 lg:py-10">
    <h2 class="text-xl">Product Details</h2>
    <p class="mt-4 lg:w-3/4">
        {{ product.description }}
    </p>

    <table class="mt-7 w-full table-auto divide-x divide-y lg:w-1/2">
        <tbody class="divide-x border">
            <tr>
                <td class="border pl-4 font-bold">City</td>
                <td class="border pl-4">{{ product.city }}</td>
            </tr>
            <tr>
                <td class="border pl-4 font-bold">District</td>
                <td class="border pl-4">{{ product.district }}</td>
            </tr>
            <tr>
                <td class="border pl-4 font-bold">Neighborhood</td>
                <td class="border pl-4">{{ product.neighborhood }}</td>
            </tr>
            <tr>
                <td class="border pl-4 font-bold">Street</td>
                <td class="border pl-4">{{ product.street }}</td>
            </tr>
            <tr>
                <td class="border pl-4 font-bold">Postal Code</td>
                <td class="border pl-4">{{ product.postal_code }}</td>
            </tr>
            <tr>
                <td class="border pl-4 font-bold">Phone</td>
                <td class="border pl-4">{{ product.phone_number }}</td>
            </tr>
            <tr>
                <td class="border pl-4 font-bold">WhatsApp</td>
                <td class="border pl-4">{{ product.whatsapp_number }}</td>
            </tr>
            <tr>
                <td class="border pl-4 font-bold">Email</td>
                <td class="border pl-4">{{ product.email }}</td>
            </tr>
        </tbody>
    </table>
</section>

<!-- <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script> -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  var mainSwiper = new Swiper('.main-swiper', {
    spaceBetween: 10,
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },
  });

  // Thumbnail click handler
  document.querySelectorAll('.thumbnail').forEach(function(thumb, idx) {
    thumb.addEventListener('click', function() {
      mainSwiper.slideTo(idx);
      document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('ring-2', 'ring-violet-500'));
      this.classList.add('ring-2', 'ring-violet-500');
    });
  });

  // Highlight the active thumbnail on slide change
  mainSwiper.on('slideChange', function() {
    document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('ring-2', 'ring-violet-500'));
    var activeThumb = document.querySelector('.thumbnail[data-index="' + mainSwiper.activeIndex + '"]');
    if (activeThumb) {
      activeThumb.classList.add('ring-2', 'ring-violet-500');
    }
  });

  // Initial highlight
  var firstThumb = document.querySelector('.thumbnail[data-index="0"]');
  if (firstThumb) {
    firstThumb.classList.add('ring-2', 'ring-violet-500');
  }
});
</script>

{% endblock %}
